
{% load static %}
{% block content %}



    <link rel="stylesheet" href="{% static 'counsellor_dashboard.css' %}">
  <body style="background-color: lightblue;">
    <nav class="navbar">
    <div class="navbar-brand">Help Mind</div>
    <ul class="navbar-links">
      <li><a href="{% url 'home' %}">Home</a></li>
      <li><a href="{% url 'counsellor_profile' %}">Profile</a></li>
      <li><a href="{% url 'logout' %}">Logout</a></li>
    </ul>
    </nav>
  <h2 style="color:#0e7390;">Welcome, {{ user.username }}!</h2>
  <section class="profile-section">
      <h2>ðŸ‘¤ Your Profile</h2>
      <div class="profile-box">
        <p><strong>Age:</strong> {{ user.counsellor.age }}</p>
        <p><strong>Experience:</strong> {{ user.counsellor.experience }}</p>
        <p><strong>Specialization:</strong> {{ user.counsellor.specialization }}</p>
        <p class="description"><strong>Description:</strong> {{ user.counsellor.description }}</p>
      </div>
    </section>
  <h2 style="color: #0e7390;">Your Bookings:</h2>

  <table border="1">
    <tr>
      <th>Client</th>
      <th>Status</th>
      <th>Completion Status</th>
      <th>Action</th>
      <th>Reschedule</th>
    </tr>
    {% for b in bookings %}
    <tr>
      <!-- show just client username -->
      <td>{{ b.client.user.username }}</td>  

      <td>
        {% if b.get_status_display == "Pending" %}
          <span style="color: orange;">Pending</span>
        {% elif b.get_status_display == "Approved" or b.status == "Completed" %}
          âœ… Scheduled for {{ b.approved_date }} at {{ b.approved_time }}
        {% endif %}
      </td>

      <td>
        {% if b.status == "Approved" or b.status == "Completed" %}
          {% if b.approved_date < current_date %}
            <span style="color: gray;">Completed</span>
          {% else %}
            <span style="color: green;">Not Completed</span>
          {% endif %}
        {% else %}
          N/A
        {% endif %}
      </td>

      <td>
        {% if b.status == "Pending" %}
          <a href="{% url 'approve_booking' b.id %}">Approve</a>
        {% else %}
          Approved
        {% endif %}
      </td>

      <td>
        {% if b.status == "Approved" and b.approved_date >= current_date %}
          <a href="{% url 'reschedule_booking' b.id %}">Reschedule</a>
         {% elif b.status == "Approved" and b.approved_date < current_date %}
          <form method="POST" action="{% url 'mark_session_completed' b.id %}" style="display:inline;">
            {% csrf_token %}
            <button type="submit" class="btn" style="background-color: #28a745;">Mark Completed</button>
          </form>
        {% else %}
          N/A
        {% endif %}
      </td>
      
    </tr>
    {% empty %}
    <tr>
      <td colspan="5">No bookings yet.</td>
    </tr>
    {% endfor %}
  </table>
  <div style="margin-top: 20px;">
    {% if messages %}
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">
          {{ message }}
        </div>
      {% endfor %}
    {% endif %}
</div>
{% endblock %}
