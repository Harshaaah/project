{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Client Dashboard</title>
  <link rel="stylesheet" href="{% static 'client_dashboard.css' %}">
</head>
<body>
  <nav class="navbar">
    <div class="navbar-brand">Care your Mind</div>
    <ul class="navbar-links">
      <li><a href="{% url 'home' %}">Home</a></li>
      <li><a href="{% url 'client_profile' %}">Profile</a></li>
      <li class="notifications">
        <a href="#" onclick="toggleNotifications()">Notifications ({{ notifications|length }})</a>
        <div id="notification-dropdown" class="notification-dropdown">
          {% if notifications %}
            {% for notification in notifications %}
              <div class="notification-item">
                <p>{{ notification.message }}</p>
                <small>{{ notification.created_at|date:"M d, Y H:i" }}</small>
              </div>
            {% endfor %}
          {% else %}
            <p>No new notifications.</p>
          {% endif %}
        </div>
      </li>
      <li><a href="{% url 'logout' %}">Logout</a></li>
    </ul>
  </nav>

  <div class="container">
    <h1>Welcome, {{ user.username }}</h1>

    <section class="profile-section">
      <h2>üë§ Your Profile</h2>
      <div class="profile-box">
        <p><strong>Age:</strong> {{ user.client.age }}</p>
        <p><strong>Interest:</strong> {{ client.interest }}</p>

        <h3> Add New Interest</h3>
        <form method="POST">
          {% csrf_token %}
          
          <label for="new_interest">Select Interest:</label>
          <select name="new_interest" id="new_interest" required>
            <option value="stress">select</option>
            <option value="stress">Stress</option>
            <option value="career">Career</option>
            <option value="relationship">Relationship</option>
            <option value="health">Health</option>
            <option value="finance">Finance</option>
          </select>
          <div>
          <button class="btn" type="submit">Add Interest</button>
        </form>

        {% if interest_message %}
        <p style="color: green;">{{ interest_message }}</p>
        {% endif %}
        {% if interest_error %}
          <p style="color: red;">{{ interest_error }}</p>
        {% endif %}
      </div>
    </section>
    



    <section class="articles-section">
      <h2> AI Recommended Articles</h2>
      <section class="profile-box">
        <p>Based on your interests: {{ interests }}</p>

      <div class="dashboard-links">
        <a href="{% url 'recommend_articles' %}">
          <button class="btn">View Recommended Articles</button>
        </a>
      </div>

    </section class="articles-section">
    <h2>üìÖ Your Bookings</h2>
    <section class="profile-box">
      
      
      {% if bookings %}
        <ul>
          
           {% comment %} {% for booking in bookings %}
            {% if booking.status == "pending" %}
                <!-- Show Pending bookings -->
                <li>
                    Counsellor: {{ booking.counsellor.user.username }} <br>
                    ( <span style="color:orange;">Pending</span> )
                    <form method="POST" action="{% url 'cancel_booking' booking.id %}" style="display:inline;">
                        {% csrf_token %}
                        <button type="submit" class="btn" style="background-color: #d81111ff;">Cancel</button>
                    </form>
                </li>
                <hr>
            {% elif booking.status == "Approved" %}
                {% if booking.approved_date >= now.date %}
                    <!-- Show Approved future bookings -->
                    <li>
                        Counsellor: {{ booking.counsellor.user.username }} <br>
                        On {{ booking.approved_date }} at {{ booking.approved_time }}
                        ( <span style="color:green;">Approved</span> )
                    </li>
                    <hr>
                {% endif %}
            {% endif %}
        {% endfor %} {% endcomment %}
        {% for booking in bookings %}
          <li>
            Counsellor: {{ booking.counsellor.user.username }} <br>

            {% if booking.status == "Approved" %}
              On {{ booking.approved_date }} at {{ booking.approved_time }}
              ( <span style="color:green;">Approved</span> )
            {% else %}
              ( <span style="color:orange;">Pending</span> )
              <form method="POST" action="{% url 'cancel_booking' booking.id %}" style="display:inline;">
                {% csrf_token %}
                <button type="submit" class="btn" style="background-color:  #d81111ff;">Cancel</button>
            </form>
            {% endif %}

            

        </li>
        <hr>
          {% endfor %}
        </ul>
      {% else %}
        <p>No bookings yet.</p>
      {% endif %}
<h2>üìñ Booking History</h2>
<section class="profile-box">
    {% if past_bookings %}
        <ul>
            {% for booking in past_bookings %}
                <li>
                    Counsellor: {{ booking.counsellor.user.username }} <br>
                    On {{ booking.approved_date }} at {{ booking.approved_time }}
                    ( <span style="color:gray;">Completed</span> )
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No past bookings.</p>
    {% endif %}
</section>


  <a href="{% url 'book_counsellor' %}">
    <button class="btn">Book Counsellor</button>
  </a>
    </section>

    {% comment %} <h2>üë®‚Äç‚öïÔ∏è Available Counsellors</h2>
    <section class="profile-box">
      
      <ul>
        {% for counsellor in counsellors %}
          <li>{{ counsellor.user.username }} ‚Äì {{ counsellor.experience }} years</li>
        {% empty %}
          <li>No counsellors available</li>
        {% endfor %}
      </ul>
    </section> {% endcomment %}
<h2>üë®‚Äç‚öïÔ∏è Available Counsellors</h2>
<div class="profile-container">
    {% for counsellor in counsellors %}
    <div class="profile-box-counsellor">
        <div class="name">{{ counsellor.user.username }}</div>
        <div class="age"><b>Age:</b> {{ counsellor.age }} years</div>
        <div class="experience"><b>Experience: </b>{{ counsellor.experience|default:"Not specified" }} years</div>
        <div class="specialization"><b>Specilization:</b>{{ counsellor.specialization|default:"No specialization available." }}</div>
        <div class="qualification"><b>Qualification:</b> {{ counsellor.qualification|default:"Not specified" }}</div>
        <div class="description"><b>Description:</b>{{ counsellor.description|default:"No description available." }}</div>
        
    </div>
    {% empty %}
    <div>No counsellors available</div>
    {% endfor %}
</div>

  </div>

  <script>
    function toggleNotifications() {
      const dropdown = document.getElementById('notification-dropdown');
      dropdown.classList.toggle('show');
    }

    // Close dropdown when clicking outside
    document.addEventListener('click', function(event) {
      const dropdown = document.getElementById('notification-dropdown');
      const notificationsLink = event.target.closest('.notifications');
      if (!notificationsLink && dropdown.classList.contains('show')) {
        dropdown.classList.remove('show');
      }
    });
  </script>
</body>
</html>
